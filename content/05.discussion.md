## Discussion

The tools and applications described here present an option to streamline the production of annotations in the GAF format, their indexing and efficient querying.
Although informative annotations could be analyzed already, the current approach has multiple limitations.
<!-- - Simplistic handling of clipped paths. -->

The indexing scheme relies on integer node IDs, compacted relative to their position in the pangenome.
If node IDs are not integer, it adds a layer of complexity for the user as they will need to convert them to integers and keep track of the translation between original pangenome and new pangenome.
Both `vg` and `odgi` offer ways to convert pangenome to a new pangenome with compact integer node IDs.

The current implementation is designed with short paths in mind, where the user wants to extract the full annotated paths in a region.
It is convenient when working with short reads, gene annotations, and most genomic repeats, for example.
Larger genomic regions can still be represented and manipulated.
For example, chromosome bands, large assembled contigs, large segmental duplications could be relevant annotations to work with.
With the current implementation, the full annotated region will be extracted when querying an overlapping region.
The extracted annotations are not clipped to the specified range which could be inconvenient to a user who zooming into a small region but would still like to know about the much larger annotated path traversing this subgraph.
To address this use case, we plan to implement an extraction mode where output annotations are trimmed to keep only the queried subgraph.

The naive metadata integration is another limitation.
Indeed, the annotation information is currently reduced to a single label.
In our applications, those label would contain for example a gene name and haplotype names, or a read coverage bin and average coverage value, all in one label.
This was easy to implement and sufficient for now because there are no tools that handle more advanced metadata organization.
For many annotations, it would be useful to keep the metadata better organized, so that the user can access/use it within visualization tools.
The different metadata could be saved using optional tags that can be added at the end of each GAF record.

We are assuming that we have annotations of the different haplotypes in the pangenome.
There is still no clear solution to lift annotations from one reference/haplotype to other haplotypes in the pangenome, except through reanalysis/reannotation of each haplotype.
The homology information embedded in the pangenome could potentially be used to propagate annotations from one haplotype to others more easily. 
This strategy can already be used by annotation tools like CAT[@doi:10.1101/gr.233460.117], as a additional source of gene annotation evidence.
In the future, these techniques might help propagate other types of annotations across the pangenome more efficiently than by reanalyzing the raw data from scratch on each haplotype.

It also highlights the limitations of the existing tools to integrate these files.
Some tools, like Bandage or GfaViz, require manual pre-processing in the form of the extraction of a subgraph and integration of the annotations as embedded paths.
The sequenceTubeMap can now handle indexed bgzipped GAF files, but the query time for large pangenome remains long in practice.
Defining and integrating annotation metadata into its interface will also require a significant amount of development.
Overall, we stress the need for visualization tools that can efficiently layout and organize many paths through a pangenome.

We showed that the GAF format, thanks to new tools for their efficient manipulation, could offer a path for the future of annotations in pangenome graphs.
Still, it is clear that more needs to be done to make it a useful solution for the community.



## Code and data availability

`vg` is available at [https://github.com/vgteam/vg](https://github.com/vgteam/vg).
The fork of Bandage that allow for path coloring is available at [https://github.com/asl/BandageNG](https://github.com/asl/BandageNG).
The sequenceTubeMap is hosted at [https://github.com/vgteam/sequenceTubemap](https://github.com/vgteam/sequenceTubemap)

The analysis presented in this manuscript is documented in the [https://github.com/jmonlong/manu-vggafannot](https://github.com/jmonlong/manu-vggafannot).
It contains scripts used to prepare the annotation files, commands and automated pipelines used to annotate them in the pangenome, and helper scripts to summarize the output files.

The annotations of the HPRC v1.1 pangenome were deposited on Zenodo at `??ZENODO_LINK??`{.red}.
This includes gene annotations, repeats from RepeatMasker, simple repeats and segmental duplications.
Coverage tracks for the `??` ENCODE ATAC-seq samples are also available in this repository.
